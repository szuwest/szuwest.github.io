<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>è®°ä¸€æ¬¡WebViewå¡«å‘è¿‡ç¨‹--ç”±æ¢è¡Œç¬¦å¼•å‘çš„è¡€æ¡ˆ</title>

    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/style.css" />
    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/pygments.css" />	
    <script src="http://szuwest.github.io/theme/js/custom.modernizr.js"></script>

    <!-- So Firefox can bookmark->"abo this site" -->

</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://szuwest.github.io">West's blog</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://szuwest.github.io/ji-yi-ci-webviewtian-keng-guo-cheng-you-huan-xing-fu-yin-fa-de-xie-an.html" rel="bookmark"
        title="Permalink to è®°ä¸€æ¬¡WebViewå¡«å‘è¿‡ç¨‹--ç”±æ¢è¡Œç¬¦å¼•å‘çš„è¡€æ¡ˆ">è®°ä¸€æ¬¡WebViewå¡«å‘è¿‡ç¨‹--ç”±æ¢è¡Œç¬¦å¼•å‘çš„è¡€æ¡ˆ</a></h3>
    </header>

<h6 class="subheader" title="2019-07-27T00:00:00">2019-07-27
</h6>


    <h1>è®°ä¸€æ¬¡WebViewå¡«å‘è¿‡ç¨‹--ç”±æ¢è¡Œç¬¦å¼•å‘çš„è¡€æ¡ˆ</h1>
<p>æœ€è¿‘ä½¿ç”¨WebViewæ‰å‘äº†ï¼Œç„¶åè‰°éš¾çˆ¬å‘ç»å†æ„Ÿè§¦å¾ˆæ·±ï¼Œå†™å‡ºæ¥å¤§å®¶å€Ÿé‰´ä¸€ä¸‹ã€‚</p>
<h3>éœ€æ±‚</h3>
<p>æˆ‘ä»¬æœ‰ä¸ªç½‘é¡µéœ€è¦ç”¨åˆ°å¾ˆå¤šjsåº“ï¼Œè¿™äº›åº“æ¯”è¾ƒå¤§ï¼Œè€Œä¸”åŸºæœ¬ä¸Šæ˜¯ä¸å˜çš„ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå°†è¿™äº›ç½‘é¡µå’ŒJSåº“æ”¾åˆ°æœ¬åœ°ï¼Œè¿›è¡ŒåŠ è½½ã€‚å˜çš„æ•°æ®ä»æœåŠ¡å™¨è·å–ï¼Œç„¶åè·Ÿæœ¬åœ°çš„HTMLç»„è£…åæ˜¾ç¤ºã€‚è¿™ç§éœ€æ±‚è¿˜æ˜¯æŒºæ™®éçš„ã€‚</p>
<h3>å®ç°æ–¹å¼</h3>
<p>ç”±webçš„åŒäº‹è°ƒè¯•å¥½HTMLæ–‡ä»¶ï¼Œä»–ä»¬æŠŠæ‰€æœ‰çš„HTMLï¼Œjs,css,imageå’Œèµ„æºä¸€èµ·æ‰“åŒ…ç»™æˆ‘ä»¬
æˆ‘ä»¬æŠŠè¿™äº›èµ„æºæ”¾åˆ°assetsç›®å½•ä¸‹ï¼ˆä¹Ÿå¯ä»¥ä¸“é—¨åœ¨assetså†å»ºä¸€ä¸ªå­ç›®å½•æ¥æ”¾ï¼‰</p>
<p>é‡‡ç”¨Androidè‡ªå¸¦çš„WebViewæ¥åŠ è½½å’Œæ˜¾ç¤ºè¿™äº›ç½‘é¡µã€‚æœ‰ä¸¤ä¸ªæ–¹æ³•<strong>loadUrl</strong>å’Œ<strong>loadDataWithBaseUrl</strong>æ–¹æ³•ã€‚</p>
<blockquote>
<p>1.loadUrl("file:///android_asset/xxxxxx.html")è¿™ç§æ–¹å¼é€‚åˆHTMLä¸éœ€è¦æ”¹å˜çš„æƒ…å†µï¼Œç›´æ¥åŠ è½½å±•ç¤ºï¼Œçœæ—¶çœåŠ›</p>
<p>2.loadDataWithBaseUrlæ–¹å¼éœ€è¦å…ˆæŠŠHTMLå†…å®¹ç°åœ¨åˆ°å†…å­˜ï¼Œç„¶åå†å±•ç¤ºã€‚è¿™ç§æ–¹å¼å¯ä»¥éšæ„ä¿®æ”¹HTMLé‡Œçš„å†…å®¹ï¼Œä¿®æ”¹å¥½å†äº¤ç”±WebViewå±•ç¤ºï¼Œçµæ´»æ€§å¼ºã€‚</p>
</blockquote>
<h3>é‡åˆ°çš„å‘</h3>
<p>æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬é‡åˆ°åŒä¸€ä¸ªHTMLæ–‡ä»¶ï¼Œé€šè¿‡loadUrlæ–¹å¼åŠ è½½å±•ç¤ºï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯é€šè¿‡loadDataWithBaseUrlåŠ è½½å±•ç¤ºï¼ŒHTMLçš„å†…å®¹æ­»æ´»å±•ç¤ºä¸å‡ºæ¥</p>
<h3>çˆ¬å‘è¿‡ç¨‹</h3>
<ul>
<li>
<ol>
<li>åå¤ç¡®è®¤loadDataWithBaseURLçš„ç”¨æ³•æœ‰æ²¡æœ‰ç”¨å¯¹ï¼ŒbaseUrlå‚æ•°æ²¡æœ‰é—®é¢˜ã€‚
mWebView.loadDataWithBaseURL("file:///android_asset/", htmlContent, "text/html", "utf-8", null).
ç½‘ä¸Šæœèµ„æ–™çœ‹çœ‹åˆ«äººçš„ç”¨æ³•ï¼Œè¿˜æœ‰æŸ¥çœ‹æˆ‘ä»¬å·¥ç¨‹é‡Œå…¶ä»–ç”¨äº†loadDataWithBaseURLæ–¹æ³•çš„åœ°æ–¹ï¼Œéƒ½æ˜¯å·®ä¸å¤šçš„ã€‚ç„¶åæˆ‘æ€€ç–‘æ˜¯htmlContentæœ‰é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯è¯»å–çš„æ—¶å€™å‡ºé”™äº†ã€‚
æˆ‘å»çœ‹ä»asseté‡Œè¯»å–æ–‡ä»¶çš„æ–¹æ³•.</li>
</ol>
</li>
</ul>
<div class="highlight"><pre><span></span>public static String getStringFromAssets(Context context,String fileName) {
        try {
            InputStreamReader inputReader = new InputStreamReader(context.getAssets().open(fileName));
            BufferedReader bufReader = new BufferedReader(inputReader);

            String line;
            StringBuilder stringBuilder = new StringBuilder();
            while ((line = bufReader.readLine()) != null) {
                stringBuilder.append(line);
            }
            return stringBuilder.toString();

        } catch (Exception e) {
            e.printStackTrace();
        }
        return &quot;&quot;;
    }
</pre></div>


<p>çœ‹ä¸Šå»å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜å‘€ã€‚æˆ‘æœäº†ä¸‹è¿™ä¸ªæ–¹æ³•åœ¨æˆ‘ä»¬å·¥ç¨‹é‡Œçš„ä½¿ç”¨ï¼Œå‘ç°è¿˜æœ‰å¾ˆå¤šä½¿ç”¨çš„åœ°æ–¹ï¼Œä»–ä»¬ä½¿ç”¨éƒ½æ²¡é—®é¢˜ã€‚æˆ‘ä¸æ”¾å¼ƒï¼Œåˆ°ç½‘ä¸Šå†æœä¸€ä¸‹ã€‚å…¨æ˜¯åŒæ ·çš„æ–¹æ³•ã€‚æˆ‘æ–­ç‚¹è°ƒè¯•ï¼Œå¹¶ä¸”æŠŠhtmlContentæ‰“å°å‡ºæ¥ï¼Œå¥½åƒæ²¡æœ‰å¤ªå¤§çš„é—®é¢˜å‘€ï¼Œä¸æ˜¯è¿™é‡Œçš„é—®é¢˜ï¼Ÿ</p>
<ul>
<li>2.æŸ¥çœ‹æˆ‘ä»¬å·¥ç¨‹é‡Œå…¶ä»–ç”¨äº†loadDataWithBaseURLæ–¹æ³•çš„åœ°æ–¹ï¼Œæˆ‘çš„ç”¨æ³•è·Ÿä»–ä»¬ä¸€è‡´ã€‚ä¸è¿‡æœ€ç»ˆæˆ‘å‘ç°æˆ‘ç”¨çš„HTMLæ–‡ä»¶è·Ÿä»–ä»¬ç”¨çš„HTMLæ–‡ä»¶æœ‰ä¸åŒçš„åœ°æ–¹ï¼šæˆ‘ä½¿ç”¨çš„HTMLæ–‡ä»¶ä¸­
æ›´å¤æ‚ä¸€äº›ï¼Œåœ¨æ–‡ä»¶é‡Œå¼•ç”¨JSèµ„æºæ–‡ä»¶ï¼Œå›¾ç‰‡æ–‡ä»¶ï¼Œåœ¨HTMLé‡Œæœ¬èº«å†…åµŒäº†JSä»£ç ã€‚æˆ‘çŒœæµ‹æ˜¯å†…åµŒJSå¯¼è‡´çš„ã€‚æˆ‘ç½‘ä¸Šæœèµ„æ–™ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¿™æ ·çš„ã€‚ç»ˆäºæœåˆ°ä¸€ç¯‡<a href="https://wenwen.sogou.com/z/q436628432.htm">æ–‡ç« </a>è¯´è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªå¸–å­æ˜¯å¾ˆä¹…ä»¥å‰çš„ã€‚ä¸‹é¢æ˜¯å®ƒçš„åŸè¯ï¼š</li>
</ul>
<blockquote>
<p>ä½¿ç”¨WebViewçš„loadUrl(url),ç½‘é¡µä¸­çš„Javascriptè¿è¡Œæ­£å¸¸ã€‚ä½†æ˜¯è·å–urlçš„htmlå†…å®¹åï¼Œä½¿ç”¨loadDataæˆ–è€…loadDataWithBaseURLä¹‹åï¼ŒJavascriptå°±ä¸èµ·ä½œç”¨äº†ï¼googleäº†ä¸€åœˆï¼Œä¼¼ä¹è¿™æ˜¯æ™®éé—®é¢˜ï¼Œä¸çŸ¥é“è¿™é‡Œçš„é«˜æ‰‹æœ‰æ³•å­è§£å†³ä¸ï¼Ÿ</p>
</blockquote>
<p>è²Œä¼¼éªŒè¯äº†æˆ‘çš„æƒ³æ³•ã€‚ä½†æ˜¯è¿™æ˜¯å¾ˆä¹…ä»¥å‰çš„å¸–å­å‘€ã€‚æˆ‘æƒ³Googleæ”¹ä¸ä¼šé‚£ä¹ˆå‚»å§ã€‚åæ¥æˆ‘è°ƒè¯•æ—¶åœ¨logcaté‡Œçœ‹åˆ°ä¸€äº›æ—¥å¿—ã€‚åŠ è½½ç½‘é¡µæ—¶æ‰“å°äº†ç±»ä¼¼ä¸‹é¢çš„æ—¥å¿—</p>
<blockquote>
<p>[INFO:CONSOLE(1)] "Uncaught SyntaxError: Unexpected identifier "</p>
</blockquote>
<p>è¯´æ˜ç½‘é¡µåœ¨è§£æJSçš„æ—¶å€™æŠ¥é”™äº†ã€‚
æˆ‘çœ‹äº†ä¸‹ç½‘é¡µä¸­JavaScriptï¼ŒæŒ‰é“ç†çš„è¿™äº›éƒ½æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºé‡‡ç”¨loadUrlæ–¹å¼åŠ è½½æ²¡é—®é¢˜ï¼Œç›´æ¥åœ¨ç”µè„‘ä¸Šæµè§ˆå™¨æ‰“å¼€ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚æˆ‘æŠŠè¿™äº›jséƒ½åˆ æ‰ï¼ŒåªåŠ äº†ä¸€æ¡console.log('1111')çš„æ‰“å°è¯­å¥ã€‚å†æ¬¡è¿è¡ŒåŠ è½½ï¼Œæ²¡æŠ¥é”™äº†ï¼ï¼è¯´æ˜å†…åµŒJavaScriptä»£ç æ˜¯å¯è¡Œçš„ã€‚é‚£å°±æ˜¯æˆ‘ä»¬åŸæœ¬çš„JavaScriptæœ‰é—®é¢˜äº†ï¼Ÿï¼Ÿ</p>
<p>æˆ‘æŠŠé‚£éƒ¨åˆ†JSæ”¾åˆ°ä¸€ä¸ªæ–°çš„å•ç‹¬çš„æ–‡ä»¶é‡Œã€‚å› ä¸ºæˆ‘ä»¬çš„HTMLæ–‡ä»¶æœ¬èº«ä¹Ÿå¼•ç”¨äº†å…¶ä»–çš„ç‹¬ç«‹JSæ–‡ä»¶ã€‚ä¸€è¿è¡Œï¼Œæ­£å¸¸åŠ è½½æ˜¾ç¤ºï¼JSè¿˜æ˜¯é‚£ä¸ªJSï¼Œæ¢åˆ°æ–‡ä»¶é‡Œå°±æ²¡é—®é¢˜äº†ï¼Ÿ</p>
<p>æ‰€ä»¥æˆ‘é‚£æ—¶å¾—å‡ºç»“è®ºï¼š
* å†…åµŒJavaScriptä»£ç åœ¨WebViewçš„è§£æè·Ÿç‹¬ç«‹JSæ–‡ä»¶ä¸å¤ªä¸€æ ·ï¼Œå¯èƒ½å†…åµŒJavaScriptä»£ç çš„è§£æè¦ä¸¥æ ¼ä¸€äº›ï¼Ÿ</p>
<p>æˆ‘å¼€å§‹éªŒè¯è¿™ä¸ªæƒ³æ³•ï¼Œå»ä¿®æ”¹å†…åµŒJavaScriptä»£ç ã€‚
æˆ‘åœ¨å¾ˆå¤šåœ°æ–¹åŠ äº†consoleæ‰“å°ï¼Œçœ‹çœ‹æ‰§è¡Œåˆ°å“ªé‡ŒæŠ¥é”™ã€‚ç„¶åæˆ‘å‘ç°è²Œä¼¼å»æ‰äº†æ³¨é‡Šï¼ŒæŠ¥é”™å°±ä¸ä¸€æ ·äº†ã€‚</p>
<blockquote>
<p>Uncaught SyntaxError: Unexpected tokenã€‚</p>
<p>Uncaught SyntaxError: Unexpected end of input</p>
</blockquote>
<p>æœ€åæˆ‘æŠŠæ³¨é‡Šéƒ½å»æ‰ï¼ŒæŠŠè¯¥åŠ åˆ†å·çš„åœ°æ–¹éƒ½åŠ ä¸Šã€‚å°±èƒ½æ­£å¸¸è¿è¡Œäº†ã€‚
æˆ‘åˆæ­¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p>
<blockquote>
<p>éœ€è¦HTMLæ–‡æ¡£é‡Œå†…åµŒJavaScriptä»£ç çš„è¯ï¼Œè¦éå¸¸æ³¨æ„JavaScriptçš„è¯­æ³•é—®é¢˜ã€‚WebViewå¯¹è¿™éƒ¨åˆ†çš„JSä»£ç è¯­æ³•è¦æ±‚éå¸¸ä¸¥ï¼Œç»å¸¸å‘ç”Ÿè¯†åˆ«ä¸äº†è€ŒæŠ¥é”™çš„æƒ…å†µã€‚
ç°åœ¨å‘ç°â‘ éå¸¸æ³¨æ„è¡¨è¾¾å¼åé¢è¦åŠ åˆ†å·ï¼Œä¸èƒ½çœç•¥åˆ†å·ï¼ï¼â‘¡ä¸èƒ½åœ¨JSé‡Œéšä¾¿åŠ æ³¨é‡Šã€‚è¦ä»”ç»†æ£€æŸ¥è¯­æ³•ï¼Œä¸¥æ ¼éµå¾ªJSæ ‡å‡†</p>
</blockquote>
<p>æˆ‘æŠŠè¿™äº›ç»“è®ºè¿˜åŠ åˆ°äº†æˆ‘ä»¬ä»£ç çš„æ³¨é‡Šäº†ï¼Œä»¥å…åäººé‡‡å‘ã€‚</p>
<p>åˆ°è¿™é‡Œé—®é¢˜è§£å†³äº†ï¼Œæˆ‘æŠŠHTMLä»assetä¸­åŠ è½½å‡ºæ¥ï¼Œå†HTMLå­—ç¬¦ä¸²ä¸­çš„ä¸€äº›å­—ç¬¦ä¸²ï¼ˆé»˜è®¤æ•°æ®ï¼‰æ›¿æ¢æˆæˆ‘ä»¬ä»æœåŠ¡å™¨å–åˆ°çš„æ•°æ®ï¼ˆçœŸå®ç”¨æˆ·æ•°æ®ï¼‰ï¼Œç„¶åè°ƒç”¨loadDataWithBaseURLæ–¹æ³•å±•ç¤ºã€‚å®Œç¾ã€‚</p>
<p>åˆ°è¿™é‡Œæœ‰äº›äººä¼šè¯´loadUrlæ–¹æ³•ä¸æ˜¯æ²¡é—®é¢˜å—ï¼Œç›´æ¥ç”¨å®ƒä¸å°±è¡Œäº†ï¼ŒæŠ˜è…¾é‚£ä¹ˆå¤šå¹²å˜›ã€‚ç¡®å®æ˜¯å¦‚æ­¤ï¼Œç”¨loadUrlæ–¹æ³•èƒ½å®ç°æˆ‘çš„éœ€æ±‚ï¼Œå®é™…ä¸Šæˆ‘ä¹Ÿè¯•ç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œæ²¡é—®é¢˜ã€‚
ä¸è¿‡é‡‡ç”¨loadUrlçš„æ–¹å¼ï¼Œå®ç°èµ·æ¥ä¸å¤ªä¸€æ ·ã€‚éœ€è¦ä¿®æ”¹JavaScriptä»£ç ã€‚è¿™äº›HTMLæ˜¯æœ‰webåŒæ—¶æä¾›çš„ï¼Œä»–ä»¬éƒ½æ˜¯å·²ç»é»˜è®¤æ•°æ®ç›´æ¥è°ƒè¯•å¥½äº†ï¼Œä¸€æ‰“å¼€å°±èƒ½å±•ç¤ºã€‚é‡‡ç”¨loadUrlçš„æ–¹æ³•ï¼Œä½ ä¸èƒ½é¢„å…ˆä¿®æ”¹HTMLæ–‡ä»¶ï¼Œåªèƒ½åœ¨åŠ è½½å®ŒHTMLæ•°æ®ä¹‹åï¼Œåœ¨WebViewçš„webclientå›è°ƒæ–¹æ³•<strong>onPageFinished</strong>é‡Œå»è°ƒç”¨JSæ–¹æ³•ã€‚</p>
<p>å°±æ˜¯è¯´ï¼š</p>
<ul>
<li>1.ä½ å°†JSé‡Œçš„window.onloadæ–¹æ³•å»æ‰ï¼Œè®©ä»–ä»¬å…ˆä¸å±•ç¤º</li>
<li>2.ä½ æ–°å¢ä¸€ä¸ªjsæ–¹æ³•ï¼Œè¿™æ–¹æ³•æ¥æ”¶ä¸€äº›å‚æ•°ï¼Œç„¶ååœ¨è¿™ä¸ªæ–¹æ³•é‡Œè°ƒç”¨æ¸²æŸ“æ–¹æ³•ï¼ˆå³åŸæ¥çš„window.onloadé‡Œçš„æ–¹æ³•ï¼‰ã€‚</li>
<li>3.åœ¨ä½ Javaä»£ç é‡Œï¼Œåœ¨WebViewçš„webclientå›è°ƒæ–¹æ³•<strong>onPageFinished</strong>é‡Œå»è°ƒç”¨ä½ æ–°å¢çš„JSæ–¹æ³•ï¼ŒæŠŠå‚æ•°éƒ½ä¼ å…¥è¿›å»ã€‚</li>
</ul>
<p>çœ‹åˆ°æ²¡æœ‰ï¼Œè¿™é‡Œè¦ä¿®æ”¹çš„ä¸œè¥¿è¿˜è›®å¤šï¼Œè¿˜è¦è¦æ±‚å®¢æˆ·ç«¯å¼€å‘äººå‘˜æ‡‚JSä»£ç ã€‚</p>
<p>é‡‡ç”¨loadDataWithBaseURLæ–¹å¼ï¼Œç†æƒ³çš„æƒ…å†µä¸‹ï¼Œä¸éœ€è¦æ”¹JSä»£ç ï¼Œç›´æ¥å‘Šè¯‰å¼€å‘äººå‘˜é»˜è®¤æ•°æ®åœ¨å“ªé‡Œï¼ŒæŠŠHTMLåŠ è½½è¿›å†…å­˜çš„æ—¶å€™ï¼Œé€šè¿‡String.replaceæ–¹æ³•ï¼ŒæŠŠé»˜è®¤æ•°æ®æ›¿æ¢ä¸ºçœŸå®æ•°æ®ï¼Œå°±å¯ä»¥äº†ã€‚</p>
<p>iOSç«¯å°±æ˜¯è¿™ä¹ˆå®ç°çš„ï¼Œä½†æ˜¯Androidè¿™è¾¹å®ç°çš„æ—¶å€™å°±é‡åˆ°äº†å‘ã€‚ã€‚ã€‚ã€‚
æˆ‘è‚¯å®šæƒ³ä¸¤ç«¯å®ç°æ–¹å¼ä¿æŒä¸€è‡´ï¼Œæ‰€æœ‰ä¼˜å…ˆé‡‡ç”¨loadDataWithBaseURLæ–¹å¼ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥è®©webå¼€å‘äººå‘˜æŒ‰ä½ çš„è¦æ±‚å†™å¥½ï¼Œé‚£ä½ ä¹Ÿä¸ç”¨æ”¹åŠ¨é‚£ä¹ˆå¤šã€‚ã€‚ã€‚</p>
<h3>èƒŒåçœŸç›¸</h3>
<p>é—®é¢˜è§£å†³äº†ï¼Œç‰ˆæœ¬ä¹Ÿå‘äº†ã€‚ä½†é—®é¢˜çš„çœŸç›¸çœŸçš„æ˜¯WebViewè§£æå†…åµŒJavaScriptæ¯”è¾ƒä¸¥æ ¼å—ï¼Ÿä»ç°è±¡æ¥çœ‹ï¼Œä¸æ”¯æŒæ³¨é‡Šï¼Œä¸èƒ½çœç•¥è¡¨è¾¾å¼çš„åˆ†å·ï¼Œè¿™æ˜æ˜¾æ˜¯<strong>æ¢è¡Œ</strong>é—®é¢˜ã€‚
æ‰€ä»¥æˆ‘æƒ³é—®é¢˜å¯èƒ½çœŸçš„å‡ºç°åœ¨ä»asseté‡Œè¯»å–æ–‡ä»¶åœ°æ–¹ã€‚çœ‹ä»£ç å°±æ˜¯æ²¡æœ‰æ˜æ˜¾é”™è¯¯ï¼Œä¸€è¡Œä¸€è¡Œçš„è¯»å–è¿›æ¥ï¼Œæ‹¼æ¥å¥½å…¨éƒ¨è¿”å›ã€‚ç½‘ä¸ŠæŸ¥åˆ°çš„æ‰€æœ‰ä»£ç éƒ½æ˜¯è¿™ä¹ˆè¯»çš„ã€‚</p>
<p>é‚£ä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶è¿›æ¥å‘¢ï¼Ÿæ‰€æœ‰æˆ‘æ‰¾äº†ä¸‹èµ„æ–™ï¼Œå°†ä»£ç æ”¹æˆä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶ã€‚</p>
<div class="highlight"><pre><span></span>public static String getStringFromAssets(ontext context,String fileName) {
        try {
            InputStreamReader inputReader = new InputStreamReader(context.getAssets().open(fileName));
            BufferedReader bufReader = new BufferedReader(inputReader);

            StringWriter out = new StringWriter();
            copy(bufReader, out);
            return out.toString();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return &quot;&quot;;
    }

    private static void copy(Reader in, Writer out) throws IOException {
        int c = -1;
        while((c = in.read()) != -1) {
            out.write(c);
        }
    }
</pre></div>


<p>æœç„¶ä»€ä¹ˆé—®é¢˜éƒ½æ²¡æœ‰ï¼çœ‹logcatæ‰“å°å‡ºæ¥çš„å†…å®¹ä¹Ÿæ˜¯è·ŸHTMLé‡Œçš„å†…å®¹ä¸€æ¨¡ä¸€æ ·ï¼Œä¹‹å‰æ–¹å¼æ‰“å°å‡ºæ¥çš„æ²¡æœ‰æ¢è¡Œå¹¶æ²¡æœ‰å¤ªè¿‡åœ¨æ„ï¼</p>
<p>é‚£åªèƒ½è¯´æ˜bufReader.readLineçš„æ–¹æ³•æœ‰é—®é¢˜ï¼Œæˆ‘ç½‘ä¸Šæœäº†ä¸‹ï¼Œè¯´è¿™ä¸ªæ–¹æ³•ä¼šè‡ªåŠ¨å»æ‰æ¢è¡Œã€‚åŸæ¥çœŸç›¸æ˜¯è¿™ä¸ªä¹ˆï¼Ÿï¼ŸåŸæ¥WebViewä¸€ç›´æ˜¯ä¸ª<strong>èƒŒé”…ä¾ </strong>å‘€ï¼Œè€Œä¸”è¿™ä¸ªé”…èƒŒäº†å¥½å¤šå¹´ğŸ˜‚ğŸ˜‚ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹æ—¶é—´çš„çœŸå‡¶readLineæ–¹æ³•çš„å£°æ˜ï¼š</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">     * Reads a line of text.  A line is considered to be terminated by any one</span>
<span class="cm">     * of a line feed (&#39;\n&#39;), a carriage return (&#39;\r&#39;), or a carriage return</span>
<span class="cm">     * followed immediately by a linefeed.</span>
<span class="cm">     *</span>
<span class="cm">     * @return     A String containing the contents of the line, not including</span>
<span class="cm">     *             any line-termination characters, or null if the end of the</span>
<span class="cm">     *             stream has been reached</span>
<span class="cm">     *</span>
<span class="cm">     * @exception  IOException  If an I/O error occurs</span>
<span class="cm">     *</span>
<span class="cm">     * @see java.nio.file.Files#readAllLines</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span>public<span class="w"> </span>String<span class="w"> </span>readLine<span class="o">()</span><span class="w"> </span>throws<span class="w"> </span>IOException<span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span>readLine<span class="o">(</span>false<span class="o">)</span><span class="err">;</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
</pre></div>


<p>æ³¨æ„çœ‹returnçš„å£°æ˜<strong>not includingany line-termination characters</strong>.
äººå®¶è¿™é‡Œè¯´å¾—å¾ˆæ¸…æ¥šå˜›ï¼Œåè¡€äº†ã€‚ã€‚ã€‚</p>
<p>å¦‚æœä½ å¯¹Javaå¾ˆç†Ÿæ‚‰ï¼Œæˆ–è€…å¯¹readLine()æ–¹æ³•ç†Ÿæ‚‰ï¼Œä½ å°±ä¸ç”¨æŠ˜è…¾é‚£ä¹ˆå¤šï¼Œå°±ä¸ä¼šæ‰å‘é‡Œäº†ã€‚</p>
<p>æˆ‘åœ¨æƒ³ä¸ºä»€ä¹ˆä¸€ç›´æ²¡å‘ç°å‘¢ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äº†è¿™ä¹ˆä¹…ï¼Œç½‘ä¸Šä¹Ÿè¿™ä¹ˆå¤šäººç”¨ï¼Œå°±æ²¡äººé‡åˆ°é—®é¢˜ï¼Ÿæˆ‘çŒœä¸»è¦åŸå› æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æ¢è¡Œç¬¦ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯æŠŠjsonæˆ–HTMLæ–‡ä»¶æ”¾assetsé‡Œï¼Œç„¶åè¯»å–å‡ºæ¥ä½¿ç”¨ã€‚jsonæ–‡ä»¶æœ‰æ²¡æœ‰æ¢è¡Œæ ¹æœ¬ä¸å½±å“ï¼æˆ‘ä»¬å·¥ç¨‹é‡Œå¤§éƒ¨åˆ†éƒ½æ˜¯è¿™ç§ç”¨æ³•ã€‚å¦‚æœHTMLé‡Œæ²¡æœ‰å†…åµŒJavaScriptä»£ç ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼å¦‚æœçœŸæœ‰å†…åµŒJavaScriptä»£ç äº†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‡‡ç”¨loadUrlæ–¹æ³•æ¥ç»•è¿‡ï¼Œå°±æ˜¯æˆ‘ä¹‹å‰çš„åšæ³•é‚£æ ·ã€‚</p>
<p>åªæœ‰æ­£é¢åˆšï¼Œæ‰ä¼šå‘ç°è¿™é‡Œæœ‰ä¸ªå‘ã€‚readLineè¿™ä¸ªæ–¹æ³•ä¸å¥½ï¼Œå¤ªæœ‰è¿·æƒ‘æ€§äº†ã€‚
è¿˜æœ‰å°±æ˜¯ä¸è¦éšä¾¿ç›¸ä¿¡ç½‘ä¸Šæ‹·æ¥çš„ä»£ç ï¼ï¼ï¼è¿™äº›è¡€çš„æ•™è®­ã€‚</p>
<p>æœ€åé™„ä¸Šä¿®æ­£ç‰ˆçš„æ­£ç¡®çš„ä»assetsé‡Œè¯»å–æ–‡ä»¶çš„æ–¹æ³•ã€‚</p>
<div class="highlight"><pre><span></span> /**
     * è·å–assetçš„æ–‡ä»¶ï¼Œè½¬åŒ–æˆString
     *
     * @param context
     * @param fileName
     * @return
     */
    public static String parseAssetsData(Context context, String fileName) {
        StringBuilder stringBuilder = new StringBuilder();
        InputStreamReader inputStreamReader = null;
        BufferedReader bfReader = null;
        try {
            AssetManager assetManager = context.getAssets();
            inputStreamReader = new InputStreamReader(assetManager.open(fileName));
            bfReader = new BufferedReader(inputStreamReader);
            String line;
            //æ³¨æ„ï¼ï¼ readLine()è¿”å›çš„å†…å®¹å·²ç»æŠŠæ¢è¡Œç¬¦å»æ‰ï¼Œæ‰€ä»¥è¦è¡¥ä¸Š
            while ((line = bfReader.readLine()) != null) {
                stringBuilder.append(line);
                stringBuilder.append(&quot;\n&quot;);
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            closeStream(inputStreamReader);
            closeStream(bfReader);
        }
        return stringBuilder.toString();
    }

    /**
     * å…³é—­æµ
     *
     * @param io
     */
    public static void closeStream(Closeable io) {
        if (io != null) {
            try {
                io.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
</pre></div>


<hr />
<p>å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç”¨ï¼Œè¯·æ‰“èµå°é’±å–æ¯å’–å•¡^_^
<img alt="æ‰“èµ" src="https://raw.githubusercontent.com/szuwest/szuwest.github.io/master/images/2018-02-21%20133111.jpg" /></p>
<p class="subheader">Category: <a href="http://szuwest.github.io/category/ji-zhu.html">æŠ€æœ¯</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/androidkai-fa-webview-javascript.html">Androidå¼€å‘ WebView JavaScript </a>
</p>




	<h4>Comments</h4>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'westblog'
        var disqus_identifier = "ji-yi-ci-webviewtian-keng-guo-cheng-you-huan-xing-fu-yin-fa-de-xie-an.html";
        var disqus_url = "http://szuwest.github.io/ji-yi-ci-webviewtian-keng-guo-cheng-you-huan-xing-fu-yin-fa-de-xie-an.html";

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://szuwest.github.io/archives.html">Archives</a>
            <li><a href="http://szuwest.github.io/tags.html">Tags</a>


        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://szuwest.github.io/category/android.html">Android</a></li>
            <li><a href="http://szuwest.github.io/category/bian-cheng-jia-gou.html">ç¼–ç¨‹æ¶æ„</a></li>
            <li><a href="http://szuwest.github.io/category/chan-pin.html">äº§å“</a></li>
            <li><a href="http://szuwest.github.io/category/ios.html">iOS</a></li>
            <li><a href="http://szuwest.github.io/category/ji-zhu.html">æŠ€æœ¯</a></li>
            <li><a href="http://szuwest.github.io/category/sheng-huo.html">ç”Ÿæ´»</a></li>
            <li><a href="http://szuwest.github.io/category/suan-fa.html">ç®—æ³•</a></li>
            <li><a href="http://szuwest.github.io/category/zong-jie.html">æ€»ç»“</a></li>
   
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://szuwest.github.io/pages/about.html">About</a></li>
            <li><a href="http://szhanfeng203.blog.163.com/">æˆ‘çš„ç”Ÿæ´»åšå®¢</a></li>
            <li><a href="http://szuwest.github.io/feeds/all.atom.xml">RSS</a></li>
        </ul>
		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/szuwest">Github</a></li>
            <li><a href="https://twitter.com/szuwest">Twitter</a></li>
            <li><a href="https://www.facebook.com/profile.php?id=1084651913">Facebook</a></li>
            <li><a href="http://weibo.com/szuwest">å¾®åš</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>West's blog by West</p>
            </div>
            </div>
    </div>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-55687145-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</footer>