<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>West's blog</title>

    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/style.css" />
    <link rel="stylesheet" href="http://szuwest.github.io/theme/css/pygments.css" />	
    <script src="http://szuwest.github.io/theme/js/custom.modernizr.js"></script>

    <!-- So Firefox can bookmark->"abo this site" -->

</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://szuwest.github.io">West's blog</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
        
        

            <article>
                <a href="http://szuwest.github.io/ji-yi-ci-webviewtian-keng-guo-cheng-you-huan-xing-fu-yin-fa-de-xie-an.html"><h3 class="article-title">记一次WebView填坑过程--由换行符引发的血案</h3></a>
<h6 class="subheader" title="2019-07-27T00:00:00">2019-07-27
</h6>


<h1>记一次WebView填坑过程--由换行符引发的血案</h1>
<p>最近使用WebView掉坑了，然后艰难爬坑经历感触很深，写出来大家借鉴一下。</p>
<h3>需求</h3>
<p>我们有个网页需要用到很多js库，这些库比较大，而且基本上是不变的。为了提高性能，将这些网页和JS库放到本地，进行加载。变的数据从服务器获取，然后跟本地的HTML组装后显示。这种需求还是挺普遍的。</p>
<h3>实现方式</h3>
<p>由web的同事调试好HTML文件，他们把所有的HTML，js,css,image和资源一起打包给我们
我们把这些资源放到assets目录下（也可以专门在assets再建一个子目录来放）</p>
<p>采用Android自带的WebView来加载和显示这些网页。有两个方法<strong>loadUrl</strong>和<strong>loadDataWithBaseUrl</strong>方法。</p>
<blockquote>
<p>1.loadUrl("file:///android_asset/xxxxxx.html")这种方式适合HTML不需要改变的情况，直接加载展示，省时省力</p>
<p>2.loadDataWithBaseUrl方式需要先把HTML内容现在到内存，然后再展示。这种方式可以随意修改HTML里的内容，修改好再交由WebView展示，灵活性强。</p>
</blockquote>
<h3>遇到的坑</h3>
<p>测试的时候，我们遇到同一个HTML文件，通过loadUrl方式加载展示，没有任何问题。但是通过loadDataWithBaseUrl加载展示，HTML的内容死活展示不出来</p>
<h3>爬坑过程</h3>
<ul>
<li>
<ol>
<li>反复确认loadDataWithBaseURL的用法有没有用对，baseUrl参数没有问题。
mWebView.loadDataWithBaseURL("file:///android_asset/", htmlContent, "text/html", "utf-8", null).
网上搜资料看看别人的用法，还有查看我们工程里其他用了loadDataWithBaseURL方法的地方，都是差不多的。然后我怀疑是htmlContent有问题，是不是读取的时候出错了。
我去看从asset里读取文件的方法.</li>
</ol>
</li>
</ul>
<div class="highlight"><pre><span></span>public static String getStringFromAssets(Context context,String fileName) {
        try {
            InputStreamReader inputReader = new InputStreamReader(context.getAssets().open(fileName));
            BufferedReader bufReader = new BufferedReader(inputReader);

            String line;
            StringBuilder stringBuilder = new StringBuilder();
            while ((line = bufReader.readLine()) != null) {
                stringBuilder.append(line);
            }
            return stringBuilder.toString();

        } catch (Exception e) {
            e.printStackTrace();
        }
        return &quot;&quot;;
    }
</pre></div>


<p>看上去并没有什么问题呀。我搜了下这个方法在我们工程里的使用，发现还有很多使用的地方，他们使用都没问题。我不放弃，到网上再搜一下。全是同样的方法。我断点调试，并且把htmlContent打印出来，好像没有太大的问题呀，不是这里的问题？</p>
<ul>
<li>2.查看我们工程里其他用了loadDataWithBaseURL方法的地方，我的用法跟他们一致。不过最终我发现我用的HTML文件跟他们用的HTML文件有不同的地方：我使用的HTML文件中
更复杂一些，在文件里引用JS资源文件，图片文件，在HTML里本身内嵌了JS代码。我猜测是内嵌JS导致的。我网上搜资料，看看是不是这样的。终于搜到一篇<a href="https://wenwen.sogou.com/z/q436628432.htm">文章</a>说这个问题，但是这个帖子是很久以前的。下面是它的原话：</li>
</ul>
<blockquote>
<p>使用WebView的loadUrl(url),网页中的Javascript运行正常。但是获取url的html内容后，使用loadData或者loadDataWithBaseURL之后，Javascript就不起作用了！google了一圈，似乎这是普遍问题，不知道这里的高手有法子解决不？</p>
</blockquote>
<p>貌似验证了我的想法。但是这是很久以前的帖子呀。我想Google改不会那么傻吧。后来我调试时在logcat里看到一些日志。加载网页时打印了类似下面的日志</p>
<blockquote>
<p>[INFO:CONSOLE(1)] "Uncaught SyntaxError: Unexpected identifier "</p>
</blockquote>
<p>说明网页在解析JS的时候报错了。
我看了下网页中JavaScript，按道理的这些都是正确的，因为采用loadUrl方式加载没问题，直接在电脑上浏览器打开也没有问题。我把这些js都删掉，只加了一条console.log('1111')的打印语句。再次运行加载，没报错了！！说明内嵌JavaScript代码是可行的。那就是我们原本的JavaScript有问题了？？</p>
<p>我把那部分JS放到一个新的单独的文件里。因为我们的HTML文件本身也引用了其他的独立JS文件。一运行，正常加载显示！JS还是那个JS，换到文件里就没问题了？</p>
<p>所以我那时得出结论：
* 内嵌JavaScript代码在WebView的解析跟独立JS文件不太一样，可能内嵌JavaScript代码的解析要严格一些？</p>
<p>我开始验证这个想法，去修改内嵌JavaScript代码。
我在很多地方加了console打印，看看执行到哪里报错。然后我发现貌似去掉了注释，报错就不一样了。</p>
<blockquote>
<p>Uncaught SyntaxError: Unexpected token。</p>
<p>Uncaught SyntaxError: Unexpected end of input</p>
</blockquote>
<p>最后我把注释都去掉，把该加分号的地方都加上。就能正常运行了。
我初步得出以下结论：</p>
<blockquote>
<p>需要HTML文档里内嵌JavaScript代码的话，要非常注意JavaScript的语法问题。WebView对这部分的JS代码语法要求非常严，经常发生识别不了而报错的情况。
现在发现①非常注意表达式后面要加分号，不能省略分号！！②不能在JS里随便加注释。要仔细检查语法，严格遵循JS标准</p>
</blockquote>
<p>我把这些结论还加到了我们代码的注释了，以免后人采坑。</p>
<p>到这里问题解决了，我把HTML从asset中加载出来，再HTML字符串中的一些字符串（默认数据）替换成我们从服务器取到的数据（真实用户数据），然后调用loadDataWithBaseURL方法展示。完美。</p>
<p>到这里有些人会说loadUrl方法不是没问题吗，直接用它不就行了，折腾那么多干嘛。确实是如此，用loadUrl方法能实现我的需求，实际上我也试用了这个方法，没问题。
不过采用loadUrl的方式，实现起来不太一样。需要修改JavaScript代码。这些HTML是有web同时提供的，他们都是已经默认数据直接调试好了，一打开就能展示。采用loadUrl的方法，你不能预先修改HTML文件，只能在加载完HTML数据之后，在WebView的webclient回调方法<strong>onPageFinished</strong>里去调用JS方法。</p>
<p>就是说：
1.你将JS里的window.onload方法去掉，让他们先不展示
2.你新增一个js方法，这方法接收一些参数，然后在这个方法里调用渲染方法（即原来的window.onload里的方法）。
3.在你Java代码里，在WebView的webclient回调方法<strong>onPageFinished</strong>里去调用你新增的JS方法，把参数都传入进去。</p>
<p>看到没有，这里要修改的东西还蛮多，还要要求客户端开发人员懂JS代码。</p>
<p>采用loadDataWithBaseURL方式，理想的情况下，不需要改JS代码，直接告诉开发人员默认数据在哪里，把HTML加载进内存的时候，通过String.replace方法，把默认数据替换为真实数据，就可以了。</p>
<p>iOS端就是这么实现的，但是Android这边实现的时候就遇到了坑。。。。
我肯定想两端实现方式保持一致，所有优先采用loadDataWithBaseURL方式。当然，你也可以让web开发人员按你的要求写好，那你也不用改动那么多。。。</p>
<h3>背后真相</h3>
<p>问题解决了，版本也发了。但问题的真相真的是WebView解析内嵌JavaScript比较严格吗？从现象来看，不支持注释，不能省略表达式的分号，这明显是<strong>换行</strong>问题。
所以我想问题可能真的出现在从asset里读取文件地方。看代码就是没有明显错误，一行一行的读取进来，拼接好全部返回。网上查到的所有代码都是这么读的。</p>
<p>那一次性读取整个文件进来呢？所有我找了下资料，将代码改成一次性读取整个文件。</p>
<div class="highlight"><pre><span></span>public static String getFileFromAssets(ontext context,String fileName) {
        try {
            InputStreamReader inputReader = new InputStreamReader(context.getAssets().open(fileName));
            BufferedReader bufReader = new BufferedReader(inputReader);

            StringWriter out = new StringWriter();
            copy(bufReader, out);
            return out.toString();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return &quot;&quot;;
    }

    private static void copy(Reader in, Writer out) throws IOException {
        int c = -1;
        while((c = in.read()) != -1) {
            out.write(c);
        }
    }
</pre></div>


<p>果然什么问题都没有！看logcat打印出来的内容也是跟HTML里的内容一模一样，之前方式打印出来的没有换行并没有太过在意！</p>
<p>那只能说明bufReader.readLine的方法有问题，我网上搜了下，说这个方法会自动去掉换行。原来真相是这个么？？原来WebView一直是个<strong>背锅侠</strong>呀，而且这个锅背了好多年😂😂。</p>
<p>我们来看看时间的真凶readLine方法的声明：</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">     * Reads a line of text.  A line is considered to be terminated by any one</span>
<span class="cm">     * of a line feed (&#39;\n&#39;), a carriage return (&#39;\r&#39;), or a carriage return</span>
<span class="cm">     * followed immediately by a linefeed.</span>
<span class="cm">     *</span>
<span class="cm">     * @return     A String containing the contents of the line, not including</span>
<span class="cm">     *             any line-termination characters, or null if the end of the</span>
<span class="cm">     *             stream has been reached</span>
<span class="cm">     *</span>
<span class="cm">     * @exception  IOException  If an I/O error occurs</span>
<span class="cm">     *</span>
<span class="cm">     * @see java.nio.file.Files#readAllLines</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span>public<span class="w"> </span>String<span class="w"> </span>readLine<span class="o">()</span><span class="w"> </span>throws<span class="w"> </span>IOException<span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span>readLine<span class="o">(</span>false<span class="o">)</span><span class="err">;</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
</pre></div>


<p>注意看return的声明<strong>not includingany line-termination characters</strong>.
人家这里说得很清楚嘛，吐血了。。。</p>
<p>如果你对Java很熟悉，或者对readLine()方法熟悉，你就不用折腾那么多，就不会掉坑里了。</p>
<p>我在想为什么一直没发现呢，这个方法用了这么久，网上也这么多人用，就没人遇到问题？我猜主要原因是大部分情况下，没有换行符也没有什么影响。我们一般都是把json或HTML文件放assets里，然后读取出来使用。json文件有没有换行根本不影响！我们工程里大部分都是这种用法。如果HTML里没有内嵌JavaScript代码也没有问题！如果真有内嵌JavaScript代码了，也可以通过采用loadUrl方法来绕过，就是我之前的做法那样。</p>
<p>只有正面刚，才会发现这里有个坑。readLine这个方法不好，太有迷惑性了。
还有就是不要随便相信网上拷来的代码！！！这些血的教训。</p>
<p>最后附上修正版的正确的从assets里读取文件的方法。</p>
<div class="highlight"><pre><span></span> /**
     * 获取asset的文件，转化成String
     *
     * @param context
     * @param fileName
     * @return
     */
    public static String parseAssetsData(Context context, String fileName) {
        StringBuilder stringBuilder = new StringBuilder();
        InputStreamReader inputStreamReader = null;
        BufferedReader bfReader = null;
        try {
            AssetManager assetManager = context.getAssets();
            inputStreamReader = new InputStreamReader(assetManager.open(fileName));
            bfReader = new BufferedReader(inputStreamReader);
            String line;
            //注意！！ readLine()返回的内容已经把换行符去掉，所以要补上
            while ((line = bfReader.readLine()) != null) {
                stringBuilder.append(line);
                stringBuilder.append(&quot;\n&quot;);
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            closeStream(inputStreamReader);
            closeStream(bfReader);
        }
        return stringBuilder.toString();
    }

    /**
     * 关闭流
     *
     * @param io
     */
    public static void closeStream(Closeable io) {
        if (io != null) {
            try {
                io.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
</pre></div>


<hr />
<p>如果你觉得这篇文章有用，请打赏小钱喝杯咖啡^_^
<img alt="打赏" src="https://raw.githubusercontent.com/szuwest/szuwest.github.io/master/images/2018-02-21%20133111.jpg" /></p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ji-zhu.html">技术</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/androidkai-fa-webview-javascript.html">Android开发 WebView JavaScript </a>
</p>



<p><a href="http://szuwest.github.io/ji-yi-ci-webviewtian-keng-guo-cheng-you-huan-xing-fu-yin-fa-de-xie-an.html#disqus_thread">comments</a></p>            </article>


                <hr  class="gradient"/>


        


            <article>
                <a href="http://szuwest.github.io/ru-he-xie-chu-bu-tai-pi-de-dai-ma.html"><h3 class="article-title">如何写出不太坏的代码</h3></a>
<h6 class="subheader" title="2019-02-28T00:00:00">2019-02-28
</h6>


<h2>如何写出不太坏的代码</h2>
<p>本来想把标题定为“如何写出好代码”的，但是转念一想，觉得自己没那么牛逼，就改成了不太坏的代码。只要不要写出太糟糕的代码，不就是好代码了吗？</p>
<p>以下只是个人的一些总结，如有异议，请出门右转。</p>
<h3>1.注重命名</h3>
<p>包括文件名，变量名，方法名。一般变量名以功能来命名，看它的名字就能知道它的用途是什么
遵循一些命名规范。Java中成员变量名一般以m开头，而OC中的成员变量一般以_开头</p>
<h3>2.遵循低耦合，高内聚的原则编写代码</h3>
<p>具体表现遵循分层分模块原则，底层模块不能依赖上层模块，逻辑层不依赖界面，绝不要把逻辑层代码和界面代码混在一起</p>
<h3>3.针对接口编程，而不是实现编程</h3>
<p>当一个类要暴露一些方法给外部调用或者通信时，先定义好接口。接口定义应该简单明了，不容易引起歧义，接口尽量少。最后才考虑内部实现，而且尽量不暴露给外部，尽量不需要外部知道内部是如何实现的</p>
<h3>4.一个类的代码量尽量不要太大，一个方法只做一件事情</h3>
<p>一个类（或者一个方法）的代码越多，出错的概率越大。一个类三到5百行代码最佳。如果一个类的代码太多，就要考虑这个类是不是做的东西太多了 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ji-zhu.html">技术</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/ioskai-fa-androidkai-fa.html">iOS开发 Android开发 </a>
</p>



<p><a href="http://szuwest.github.io/ru-he-xie-chu-bu-tai-pi-de-dai-ma.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/ru-he-xie-chu-bu-tai-pi-de-dai-ma.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/2018nian-zong-jie-he-2019nian-zhan-wang.html"><h3 class="article-title">2018年总结和2019年展望</h3></a>
<h6 class="subheader" title="2019-02-10T00:00:00">2019-02-10
</h6>


<h2>2018年总结和2019年展望</h2>
<p>一直都没写，不愿意动手，明天就要新的一年上班了，所以还是简单写写吧。</p>
<h3>2018年总结</h3>
<p>1.上半年过得很不好，一直非常焦虑，公司发展不好，心里很慌，害怕倒闭了被动找工作。后面决定满一年后就换工作，但是一直没找到合适的。在年中的时候一度非常焦虑，很长一段时间没碰过香烟了，因为心情太过焦虑，又开始在公司偶尔抽了起来。直到后面我在那个公司满一年后，真正决定开始找新工作，找到了一个自己比较合适的公司，心才定下来。</p>
<p>2.下班年去了新公司后很忙，每天都在马不停蹄的赶，提供工作效率，但是并不觉得很累。很久没有这种感觉了。终于找到跟自己比较匹配的工作，也能比较大的发挥自己才能的工作。老板的价值观，直接上级的价值观跟自己都比较契合，公司的文化也挺好。真心希望能在这家公司发挥自己的才能，也希望公司能做大做强。</p>
<h3>2019年展望</h3>
<p>2019年还是希望工作上能继续发挥能量，希望自己的技术能力和管理能力都能得到提升，还有希望自己的团队的每个人的能力都得到提升，当然也希望他们能得到相应的报酬。</p>
<p>2019年有两件大事。</p>
<p>1.新房装修。一是要找钱装修，二是要在年底前装修完，希望能在农历年前住进去。新房装修是个大工程，自己完全没有经验，所以要多花点心思。</p>
<p>2 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/sheng-huo.html">生活</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/zong-jie.html">总结 </a>
</p>



<p><a href="http://szuwest.github.io/2018nian-zong-jie-he-2019nian-zhan-wang.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/2018nian-zong-jie-he-2019nian-zhan-wang.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/ioskai-fa-ru-he-zuo-wai-bu-ce-shi.html"><h3 class="article-title">iOS开发如何做外部测试</h3></a>
<h6 class="subheader" title="2019-01-05T00:00:00">2019-01-05
</h6>


<h2>iOS开发如何做外部测试</h2>
<p>我们做APP开发的，开发出来的APP还未上线，又要想给别人用一下，该怎么做？实际上这是我们每个做APP开发的人都会遇到的，但是并不是每个人都清楚怎么做，有哪些方式。今天我们就来讲一讲。</p>
<p>在将iOS的APP如何给别人使用和测试前，先说一下安卓APP开发是怎么做的。安卓端是很简单的，你只要先生成一个证书文件keystone，然后用这个文件给apk签名，就可以将apk发给任意一个人安装使用了。这很简单，也很方便。可是iOS的就没那么容易了。我们还是从最简单的开发人员如何用真机测试开始说起。</p>
<h3>真机调试</h3>
<p>我们有了一个想法，并开始写代码，模拟器调试很方便，要在iPhone上看效果怎么办了。你直接将iPhone连上电脑是不行的。现在的情况至少你需要一个Apple ID，在Xcode上登录你的账号，在调试前Xcode会自动帮你初始化一些东西，然后就可以将APP安装到你的iPhone上了。在以前，你这个AppleID不能是普通的账号，必须是付了前的开发者账号才行。现在苹果放宽限制了。</p>
<p>这种方式的做法是你的手机必须连上你的电脑，在Xcode上选择你的iPhone来调试，Xcode会自动帮你注册设备的UDID。如果你没办法把iPhone连接到电脑上呢？或者不方便把iPhone连接到电脑上，毕竟如果是老板的手机的话，不方便那种做的。那我们需要一种把安装包提供给别人安装，或者一个地址给别人安装的方式。</p>
<h3>adhoc 方式</h3>
<p>我们将项目archive后，在导出（现在Xcode叫distribution）的时候，有个选项是adhoc ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ji-zhu.html">技术</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/ioskai-fa-betace-shi-testflight-gong-kai-lian-jie.html">iOS开发 beta测试 TestFlight 公开链接 </a>
</p>



<p><a href="http://szuwest.github.io/ioskai-fa-ru-he-zuo-wai-bu-ce-shi.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/ioskai-fa-ru-he-zuo-wai-bu-ce-shi.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/svgtu-pian-zai-yi-dong-duan-de-ying-yong-jie-jue-fang-an.html"><h3 class="article-title">SVG图片在移动端的应用解决方案</h3></a>
<h6 class="subheader" title="2018-11-03T00:00:00">2018-11-03
</h6>


<h2>SVG图片在移动端的应用解决方案</h2>
<p>近几年来SVG使用得越来越多，就连Android的官方库也加入VectorDrawable的支持。这个类就是用来支持向量图的。SVG图片在web端使用非常广泛，我第一次接触这个也是在做react-native的项目中使用的。当时我们要做一些动画，需要从一个形状变换成另一个形状，这种一般都是用矢量图来做的。当时设计师就给了我一些矢量图，于是我就开始研究这个东西。</p>
<p>在react-native中，有专门一个库叫<a href="https://github.com/react-native-community/react-native-svg">react-native-svg</a>来处理这个。不过当时要做两个SVG形状的动画变化，并不是任何一个形状都可以的，需要遵循一定的标准。设计师给我的两个SVG文件并不能转换。后来是我自己根据文件里的一些关键参数自己在代码里直接画出来后，再做转换动画。</p>
<p>最近我在做的native项目中，也遇到了要用SVG的图片。我们的项目里要从服务器下载SVG图片来展示。我们要实现的这些文件是需要服务器动态配置的，也就是说我们不能预先打包进我们的APP里。所以我们这里的要提供一个解决方案，跟图片JPG图片一样显示，缓存。</p>
<p>这个需求跟之前我遇到的那个需求是很不一样的，之前的是设计师已经定义好图片，我们工程师直接拿到文件在程序里展示，不需要考虑下载和缓存之类的。这种需求其实很简单，我们实际上大部分的需求就是这种需求，网上有很多库可以完成这种需求。把SVG图片跟JPG等普通图片一样使用，网上的方案还真不多，特别是iOS方面。。。。</p>
<p>要像普通图片一样使用，就要考虑下载，本地缓存，内存缓存。像这种需求，我们移动端都会使用专门的图片框架，像安卓端的glide，UIL等，iOS端的SDWebImage等。但是这种库它是默认都不会考虑SVG图片。但是我们最好还是像使用这种框架来处理SVG图片 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ji-zhu.html">技术</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/suan-fa-svg-androidsvg-glide-macaw.html">算法 SVG androidsvg glide Macaw </a>
</p>



<p><a href="http://szuwest.github.io/svgtu-pian-zai-yi-dong-duan-de-ying-yong-jie-jue-fang-an.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/svgtu-pian-zai-yi-dong-duan-de-ying-yong-jie-jue-fang-an.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/tan-tan-gui-bing-pai-xu-suan-fa.html"><h3 class="article-title">谈谈归并排序算法</h3></a>
<h6 class="subheader" title="2018-08-06T00:00:00">2018-08-06
</h6>


<h2>谈谈归并排序算法</h2>
<p>归并排序算法是一个很重要的算法。在排序算法中，算是非常重要的一个算法。我们常说的数组归并排序，是指二路归并排序算法，时间复杂度是O(nlog(n)),空间负责度是O(n).核心的思想就是对两个有序数组合并成一个有序数组。对于一个未排序的数组怎么产生两个已排序的数组呢？其实就是对数组不断的分割，分割成多个只有一个元素的数组。只有一个元素的数组，当然这个数组就是有序的了。然后再将这些数组进行两两合并，合并后的数组还是有序数组，这样再次进行两两合并，最终可以合并成一个有序数组，这样排序就完成了。</p>
<p>归并排序的算法看起来不是很复杂，但是实现起来我觉得不是那么简单。首先它需要额外的空间，这个额外的空间怎么分配跟算法实现方式有关。然后算法的实现方式有递归方式和迭代方式两种。网上流行的都是递归方式。</p>
<h3>递归方式</h3>
<p>递归方式采用典型算法：分治法来进行。</p>
<ul>
<li>1.将数组分为两半，前一半和后一半。</li>
<li>2.将这两半进行有序数组合并</li>
<li>3.继续进行第1步，直到数组不能在分为止</li>
</ul>
<p>这里明显采用了递归定义，递归定义其实不是那么好理解，也不是那么难理解。简单来说就是不断的将一个数组进行对半分，一直分到不能分为止，这样最终就会分得很多个元素个数为1的数组，然后再将这些数组进行两两合并。注意子数组可能是奇数个，但是这也没关系，没得合并的就暂时放在原位，下一次合并的时候总会用到 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/suan-fa.html">算法</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/suan-fa-gui-bing-pai-xu.html">算法 归并排序 </a>
</p>



<p><a href="http://szuwest.github.io/tan-tan-gui-bing-pai-xu-suan-fa.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/tan-tan-gui-bing-pai-xu-suan-fa.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/zhong-guo-hu-lian-wang-qun-ti-gen-ji-nian-qian-fa-sheng-liao-ju-da-bian-hua.html"><h3 class="article-title">中国互联网群体跟几年前发生了巨大变化</h3></a>
<h6 class="subheader" title="2018-08-04T00:00:00">2018-08-04
</h6>


<h2>中国互联网群体跟几年前发生了巨大变化</h2>
<h3>抖音和拼多多</h3>
<p>今天晚上刷着刷着抖音的时候，我突然意识到现在的互联网跟几年前的互联网已经发生了巨大的变化。这个变化其实很在就开始，也很早有人提过了。但是我自己也是刚刚才深刻的意识到这一点。</p>
<p>我在抖音上只关注了几个人，这些人都基本上是在农村或者小城市生活的。然后联想到最近吵得的很火的拼多多的用户群体，还有更早的快手，现在很火的应用的主要用户群体，都是以小城市和农村的用户为主。所以我突然意识到，现在已经不是以前那个以社会白领用户或者高端用户为主的互联网了。如果现在要做纯互联网的应用，就要考虑“低端”用户为主了，可以说得小城市或者农村的用户得天下了。</p>
<p>你看拼多多，3年就上市了，市值超过200亿美金，号称有3亿用户。而抖音估值也不低于100亿美金。拼多多被很多都市白领吐槽质量差假货多，殊不知人家的主要用户就不是你们。而抖音上很多内容都是三四线城市的人或者农村人发的。我估计抖音后台应该很清楚，抖音的发布内容主要用户应该是三四线以外的用户群体。为什么会这样子，我想在我说我的想法之前先说说别的。</p>
<p>我自己最常用的几个应用是微信，微博，雪球，还有知乎等一些跟自己专业相关的社区应用。微信是通信工具没的说，但是里面的公众号内容其实主要是给社会精英，白领消费的。微博，典型的社会精英和媒体社交平台。知乎，大部分也是社会白领在上。这就是我们以前开发互联网应用的主要目标用户群体。</p>
<p>你看，我们一致性的忽略了“低端”用户。其实不是我们故意的，而且以前这些用户不存在或者没有消费能力 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/sheng-huo.html">生活</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/hu-lian-wang.html">互联网 </a>
</p>



<p><a href="http://szuwest.github.io/zhong-guo-hu-lian-wang-qun-ti-gen-ji-nian-qian-fa-sheng-liao-ju-da-bian-hua.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/zhong-guo-hu-lian-wang-qun-ti-gen-ji-nian-qian-fa-sheng-liao-ju-da-bian-hua.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/duo-jia-gong-si-de-ren-zheng-bi-dui-suan-fa-ti-yan-he-kai-fa-gan-xiang.html"><h3 class="article-title">多家公司的人证比对算法体验和开发感想</h3></a>
<h6 class="subheader" title="2018-07-13T00:00:00">2018-07-13
</h6>


<h1>多家公司的人证比对算法体验和开发感想</h1>
<p>最近在开发一个声纹采集一体机系统，这个系统里用到了人证比对功能，即刷身份证后拍照，然后将身份证里面的照片跟拍照比对，验证是否是同一个人。我们不是做人脸识别的公司，所以人脸识别功能当然是接入别人的SDK，这里我们找了好多家的人脸算法，对接过程中也遇到很多问题。经过这次的开发，我了解到这个行业的一些现状。</p>
<p>我们的系统主要运行在Windows电脑上，而且需要无网络也能使用，所以人脸算法必须是用离线版的。人脸算法厂家一般对外提供两种方式：在线版和离线版。一般在线版都可以提供免费试用，离线版需要授权使用。</p>
<h2>云端方案</h2>
<p>在线版的人脸识别我试用过依图科技的和中科视拓的SDK。在我们的应用声临其境APP上有个声纹购物的场景，需要人脸验证。这两个厂家提供的API都差不多，依图的API安全性考虑更全面，错误码定义的比较详细。还有他们的API共同点是，图片传输都是将图片数据进行base64编码后传输的。至于准确率，感觉都差不多，没有特别明显的差距。</p>
<h2>离线方案</h2>
<p>离线版的人脸算法用得比对多。因为它是用在我们要卖的机器上，而在线版的我们只是做试验。离线版的集成和使用要比在线版麻烦很多。由于离线版要给出算法库，处于安全和容易被拷贝的原因，都是要先授权的。授权的方式一般有两种：在设备上接入加密狗USB key或者绑定设备机器码的方式。加密狗方式比较方便，我们一般采用这种方式。</p>
<p>我们接入了很多厂家，有阅面科技，中控，杰锐达，商汤，我还把开源的dlib人脸识别也接入了 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ji-zhu.html">技术</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/ren-lian-jian-ce-ren-zheng-bi-dui-dlib-electron.html">人脸检测 人证比对 dlib electron </a>
</p>



<p><a href="http://szuwest.github.io/duo-jia-gong-si-de-ren-zheng-bi-dui-suan-fa-ti-yan-he-kai-fa-gan-xiang.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/duo-jia-gong-si-de-ren-zheng-bi-dui-suan-fa-ti-yan-he-kai-fa-gan-xiang.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/flutterkuang-jia-yan-jiu-he-yu-rndui-bi.html"><h3 class="article-title">Flutter框架研究和与RN对比</h3></a>
<h6 class="subheader" title="2018-03-16T00:00:00">2018-03-16
</h6>


<h2>Flutter是什么</h2>
<p>现在技术更新迭代真的很快，每隔几年就会出现一些新的技术。当然，Flutter出现有有一点时间了，只不过还未真是发布，但是已经有一些人在使用了。这篇文章主要内容来自我在公司内部的一次分享会，所以大部分内容都是提炼。</p>
<ul>
<li>Flutter 是由 Google 的工程师团队打造的，用于创建高性能、跨平台的移动应用的框架。</li>
<li>Flutter 针对当下以及未来的移动设备进行优化，专注于 Android and iOS 低延迟的输入和高帧率</li>
<li>Flutter的设计跟react-native很像，但是比RN进了一步</li>
<li>Flutter的开发语言是Dart</li>
</ul>
<h2>移动端跨平台开发技术演进</h2>
<p>现在主流的移动开发平台是Android和iOS，之前还有过windows phone，每个平台的开发技术都不太一样。大家都是针对每个平台开发应用。自然有人就会觉得这样效率低下，想进行跨平台开发。从最开始的Hybrid混合开发技术，到RN的桥接技术，到现在新兴的Flutter技术，跨平台开发技术一直在演进。</p>
<p>以往最早的Hybrid开发，主要依赖于WebView。但是WebView是一个很重的控件，很容易产生内存问题，而且复杂的UI在WebView上显示的性能不好。react-native技术抛开了WebView，利用JavaScriptCore来做桥接，将js调用转为native调用，只牺牲了小部分性能获取的跨平台开发，这是一大进步。所以现在react-native很流行的原因。</p>
<p><img alt="react-native原理图" src="https://res.infoq.com/articles/why-is-flutter-revolutionary/zh/resources/2.png" /></p>
<p>上图react-native框架原理</p>
<p>Flutter实现跨平台采用了更为彻底的方案 ...</p><p class="subheader">Category: <a href="http://szuwest.github.io/category/ji-zhu.html">技术</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/reactnative-flutter.html">ReactNative Flutter </a>
</p>



<p><a href="http://szuwest.github.io/flutterkuang-jia-yan-jiu-he-yu-rndui-bi.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/flutterkuang-jia-yan-jiu-he-yu-rndui-bi.html">Read More</a>
                <hr  class="gradient"/>
            </article>

        


            <article>
                <a href="http://szuwest.github.io/jenkins-slave-reactnativexiang-mu-zi-dong-da-bao.html"><h3 class="article-title">Jenkins slave ReactNative项目自动打包</h3></a>
<h6 class="subheader" title="2018-03-08T00:00:00">2018-03-08
</h6>


<h1>Jenkins slave ReactNative项目自动打包</h1>
<p>这次我想在谈谈Jenkins自动打包的问题。针对react-native项目。
一般情况下，我们都是在一台电脑上安装Jenkins，然后在该电脑上打开Jenkins网页进行打包配置。如果我们有很多项目，分布在不同的电脑，而且运行的系统也不同，这时候我们需要一个master来统一管理这些电脑，然后统一在一个网页上进行打包配置。这就是Jenkins的master-slave打包模式。这种模式跟单机模式稍有不同，这里主要讲怎么配置slave。</p>
<h2>slave节点配置</h2>
<ul>
<li>首先slave上也同样要安装Jenkins和相关的打包所依赖的环境，一个都不能少。配置好之后，我们并不需要在本机上打开Jenkins网页来创建项目，配置项目等，而是要到主机上去配置。在去主机的Jenkins管理页面上新建节点之前，从机还需要做一些其他配置。</li>
<li>打开远程登录。在系统设置--&gt;共享，然后选中远程登录，允许所有用户访问。</li>
<li>记住本机IP地址。在系统设置--&gt;网络，可以看到当前网络的IP地址。为了以后方便，可以将IP地址设置为一个固定IP地址。不然当该电脑重启之后，IP地址可能会变，然后主机再按照之前配置的旧IP连接从机的时候，就连不上了。Mac电脑配置固定IP也有注意的地方。我第一次配置就是没有成功，上不了网。选择手动方式，然后填上一个没有被占用的IP地址，然后，子网掩码也要注意，如果跟服务器是跨网段访问的，需要注意255.255 ...</li></ul><p class="subheader">Category: <a href="http://szuwest.github.io/category/ji-zhu.html">技术</a>

    Tagged: 
    <a href="http://szuwest.github.io/tag/reactnative-jenkins-ios.html">ReactNative Jenkins iOS </a>
</p>



<p><a href="http://szuwest.github.io/jenkins-slave-reactnativexiang-mu-zi-dong-da-bao.html#disqus_thread">comments</a></p>                <a class="button radius secondary small right" href="http://szuwest.github.io/jenkins-slave-reactnativexiang-mu-zi-dong-da-bao.html">Read More</a>
                <hr  class="gradient"/>
            </article>

            <!-- /#posts-list -->
<div class="pagination-centered">
<h6 class="subheader">Page 1 of 6</h6>

<p>

        <a href="http://szuwest.github.io/index2.html">Next &raquo;</a>
</p>
</div>

    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://szuwest.github.io/archives.html">Archives</a>
            <li><a href="http://szuwest.github.io/tags.html">Tags</a>


        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://szuwest.github.io/category/android.html">Android</a></li>
            <li><a href="http://szuwest.github.io/category/bian-cheng-jia-gou.html">编程架构</a></li>
            <li><a href="http://szuwest.github.io/category/chan-pin.html">产品</a></li>
            <li><a href="http://szuwest.github.io/category/ios.html">iOS</a></li>
            <li><a href="http://szuwest.github.io/category/ji-zhu.html">技术</a></li>
            <li><a href="http://szuwest.github.io/category/sheng-huo.html">生活</a></li>
            <li><a href="http://szuwest.github.io/category/suan-fa.html">算法</a></li>
   
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://szuwest.github.io/pages/about.html">About</a></li>
            <li><a href="http://szhanfeng203.blog.163.com/">我的生活博客</a></li>
            <li><a href="http://szuwest.github.io/feeds/all.atom.xml">RSS</a></li>
        </ul>
		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/szuwest">Github</a></li>
            <li><a href="https://twitter.com/szuwest">Twitter</a></li>
            <li><a href="https://www.facebook.com/profile.php?id=1084651913">Facebook</a></li>
            <li><a href="http://weibo.com/szuwest">微博</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>West's blog by West</p>
            </div>
            </div>
    </div>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-55687145-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</footer>